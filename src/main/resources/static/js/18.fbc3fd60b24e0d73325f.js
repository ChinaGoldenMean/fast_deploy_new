webpackJsonp([18],{ZvoF:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t("mvHQ"),i=t.n(s),r=t("z4ls"),o=t("lKKt"),l={role:r.d,base:o.d},n={name:"crole",data:function(){return{name:"role",tableData:[],tableDataBase:[],dialogVisible:!1,dialogVisible1:!1,dialogVisible2:!1,dialogVisible3:!1,dialogVisible4:!1,listLoading:!1,getBasePerNamesList:[],getBasePerNamesList1:[],getBasePerNamesList2:[],getBasePerNamesList3:[],getBasePerNamesList4:[],dialogData:{type:"add",row:{}},formData:{basePerNames:[]},formDialog:!1,queryParams:{NameCode:"",beginTime:"",endTime:"",pageNum:1,pageSize:5},queryParams1:{NameCode:"",beginTime:"",endTime:"",pageNum:1,pageSize:5},pages:1,total:1,gridData:[]}},mounted:function(){this.getList()},methods:{getRowKey:function(e){return e.id},handleSelectionChange:function(e){},getBasePerNames:function(){this.getBasePerNamesList=this.formData.basePerNames.map(function(e){if("权限管理"==e.basePerName||"开发发布菜单权限"==e.basePerName)return e.basePerName}).filter(function(e){return!(!e||""===e)}),this.getBasePerNamesList1=this.formData.basePerNames.map(function(e){if("模块管理维护权"==e.basePerName||"模块管理查询权"==e.basePerName||"模块管理菜单权"==e.basePerName||"pod管理菜单权"==e.basePerName||"pod管理查询权"==e.basePerName)return e.basePerName}).filter(function(e){return!(!e||""===e)}),this.getBasePerNamesList2=this.formData.basePerNames.map(function(e){if("发布管理维护权"==e.basePerName||"发布管理查询权"==e.basePerName||"模块pod发布维护权"==e.basePerName||"模块pod发布查询权"==e.basePerName||"发布管理菜单权"==e.basePerName||"发布概况菜单权"==e.basePerName||"计费发布管理菜单权"==e.basePerName||"统一发布管理菜单权"==e.basePerName||"自定义发布菜单权"==e.basePerName||"自定义发布维护权"==e.basePerName||"自定义发布查询权"==e.basePerName||"发布清单菜单菜单权"==e.basePerName||"发布清单菜单维护权"==e.basePerName||"开发发布菜单权"==e.basePerName)return e.basePerName}).filter(function(e){return!(!e||""===e)}),this.getBasePerNamesList3=this.formData.basePerNames.map(function(e){if("镜像制作维护权"==e.basePerName||"镜像制作查询权"==e.basePerName||"镜像列表维护权"==e.basePerName||"镜像列表查询权"==e.basePerName||"镜像管理菜单权"==e.basePerName||"镜像制作菜单权"==e.basePerName||"镜像列表菜单权"==e.basePerName||"亚信镜像管理菜单权"==e.basePerName||"镜像管理维护权"==e.basePerName)return e.basePerName}).filter(function(e){return!(!e||""===e)}),this.getBasePerNamesList4=this.formData.basePerNames.map(function(e){if("权限管理"!=e.basePerName&&"开发发布菜单权限"!=e.basePerName&&"模块管理维护权"!=e.basePerName&&"模块管理查询权"!=e.basePerName&&"模块管理菜单权"!=e.basePerName&&"pod管理菜单权"!=e.basePerName&&"pod管理查询权"!=e.basePerName&&"发布管理维护权"!=e.basePerName&&"发布管理查询权"!=e.basePerName&&"模块pod发布维护权"!=e.basePerName&&"模块pod发布查询权"!=e.basePerName&&"发布管理菜单权"!=e.basePerName&&"发布概况菜单权"!=e.basePerName&&"计费发布管理菜单权"!=e.basePerName&&"统一发布管理菜单权"!=e.basePerName&&"自定义发布菜单权"!=e.basePerName&&"自定义发布维护权"!=e.basePerName&&"自定义发布查询权"!=e.basePerName&&"发布清单菜单菜单权"!=e.basePerName&&"发布清单菜单维护权"!=e.basePerName&&"开发发布菜单权"!=e.basePerName&&"镜像制作维护权"!=e.basePerName&&"镜像制作查询权"!=e.basePerName&&"镜像列表维护权"!=e.basePerName&&"镜像列表查询权"!=e.basePerName&&"镜像管理菜单权"!=e.basePerName&&"镜像制作菜单权"!=e.basePerName&&"镜像列表菜单权"!=e.basePerName&&"亚信镜像管理菜单权"!=e.basePerName&&"镜像管理维护权"!=e.basePerName)return e.basePerName}).filter(function(e){return!(!e||""===e)})},setRoleNames:function(){this.dialogVisible=!0},setRoleNames1:function(){this.dialogVisible1=!0},setRoleNames2:function(){this.dialogVisible2=!0},setRoleNames3:function(){this.dialogVisible3=!0},setRoleNames4:function(){this.dialogVisible4=!0},handleSizeChange:function(e){this.queryParams.pageSize=e,this.getlist()},handleCurrentChange:function(e){this.queryParams.pageNum=e,this.getlist()},filterHandler:function(e,a,t){return a[t.property]===e},getList:function(){var e=this;e.listLoading=!0,l[this.name](e.queryParams).then(function(a){var t=a.data.data,s=a.data.code;if(200===s){if("base"==e.name){e.tableDataBase=t.list,void 0!=e.$refs.multipleTable&&e.$refs.multipleTable.clearSelection();var r=JSON.parse(i()(e.formData.basePerNames));if(""!=r&&void 0!=r&&r.length>0)for(var o=0;o<e.tableDataBase.length;o++)for(var l=0;l<r.length;l++)r[l].id==e.tableDataBase[o].id&&e.$refs.multipleTable.toggleRowSelection(e.tableDataBase[o],!0);e.formData.basePerNames=r}else e.tableData=t;e.total=t.total,e.pages=t.pages,e.queryParams.pageNum=t.pageNum,e.queryParams.pageSize=t.pageSize}else{"未查询到任何数据"!=a.data.msg&&201!=s||(e.tableData=[],e.total=0)}setTimeout(function(){e.listLoading=!1},200)})},getlist:function(){var e=this,a=this;Object(o.d)(this.queryParams).then(function(t){var s=t.data.data,i=t.data.code;200===i?(a.tableDataBase=s.list,a.total=s.total,a.pages=s.pages,e.queryParams.pageNum=s.pageNum,e.queryParams.pageSize=s.pageSize):"未查询到任何数据"!=t.data.msg&&201!=i||(a.tableDataBase=[]);setTimeout(function(){},200)})},selectSubmit:function(){null!=this.userTemplateSelection&&(this.formData.cname=this.userTemplateSelection.cname,this.formData.username=this.userTemplateSelection.username,this.formData.userId=this.userTemplateSelection.id),this.formData.basePerNames=this.$refs.multipleTable.selection,this.formDialogCuser=!1,this.closeFormDialog("base"),this.getBasePerNames()},openDialog:function(e,a){var t=this;if("add"==a&&(this.formDialog=!0,this.dialogData={type:"add",row:{title:"新增角色"}}),"update"==a){this.formData={roleName:e.roleName,roleCode:e.roleCode,createTime:e.createTime,updateTime:e.updateTime,id:e.id,basePerNames:[]},this.getBasePerNames(),this.formData.roleList={"发布管理":["发布管理维护权","发布管理查询权","模块pod发布维护权","模块pod发布查询权","发布管理菜单权","发布概况菜单权","计费发布管理菜单权","统一发布管理菜单权","自定义发布菜单权","自定义发布维护权","自定义发布查询权","发布清单菜单菜单权","发布清单菜单维护权","开发发布菜单权"],"镜像管理":["镜像制作维护权","镜像制作查询权","镜像列表维护权","镜像列表查询权","镜像管理菜单权","镜像制作菜单权","镜像列表菜单权","亚信镜像管理菜单权","镜像管理维护权"],"模块管理":["模块管理维护权","模块管理查询权","模块管理菜单权","pod管理菜单权","pod管理查询权"],"基础配置":["环境配置维护权","环境配置查询权","中心配置维护权","中心配置查询权","凭证管理维护权","凭证管理查询权","基础配置菜单权","环境配置菜单权","中心配置菜单权","凭证配置菜单权","配置管理菜单权","配置管理维护权","节点配置菜单权","节点配置维护权","节点配置查询权","需求管理","需求审核"],"权限管理":["权限管理","开发发布菜单权限"],"普通查看权限":["模块pod发布查询权"]},this.dialogData={type:"update",row:{title:"修改用户",data:e}};var s=this;Object(r.c)(e.id).then(function(e){var a=e.data.data;200===e.data.code&&(s.formData.basePerNames=a,t.getBasePerNames()),s.formDialog=!0,setTimeout(function(){s.listLoading=!1},200)})}"delete"==a&&this.$confirm("确定要删除选中的资源吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.resourceDelete(e)}).catch(function(){t.$message({type:"info",message:"已取消"})}),"base"==a&&(this.name="base",this.getList())},closeFormDialog:function(e){"role"==e&&(this.dialogData={type:"add",row:{}},this.formDialog=!1,this.formData={}),"base"==e&&(this.name="role")},permissionCheck:function(e){var a=[];return void 0!=this.envPermission&&this.envPermission.permissionSet&&(a=this.envPermission.permissionSet),a.includes(e)},submit:function(){var e=this;if(""!=this.formData.roleName&&void 0!=this.formData.roleName)if(""!=this.formData.roleCode&&void 0!=this.formData.roleCode){var a=new FormData;a.append("roleName",this.formData.roleName),a.append("roleCode",this.formData.roleCode),"update"==this.dialogData.type&&a.append("id",this.dialogData.row.data.id);var t=this;("add"==this.dialogData.type?r.a:r.f)(a).then(function(a){if(200==a.data.code){if("add"!=t.dialogData.type){var s=new FormData;s.append("roleId",e.formData.id);var i=t.formData.basePerNames.map(function(e){return e.id});s.append("basePermissionIds",i),Object(r.e)(s).then(function(a){200==a.data.code?e.$message({message:a.data.msg,type:"success"}):e.$message({message:a.data.msg,type:"error"})})}t.formDialog=!1,t.closeFormDialog("role"),t.getList()}else e.$message({message:a.data.msg,type:"error"})})}else this.$message({message:"角色Code不能为空",type:"error"});else this.$message({message:"角色名称不能为空",type:"error"})},resourceDelete:function(e){var a=this;Object(r.b)({roleId:e.id}).then(function(e){200==e.data.code?(a.getList(),a.$message({message:e.data.msg,type:"success"})):a.$message({message:e.data.msg,type:"error"})})}},components:{}},m={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("el-main",[t("el-row",{staticClass:"filter-container",attrs:{type:"flex"}},[t("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(a){return e.openDialog({},"add")}}},[e._v("新增")])],1),e._v(" "),t("el-card",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"element-loading-text":"拼命加载中...","highlight-current-row":!0}},[t("el-table-column",{attrs:{align:"center",label:"序号",type:"index",width:"100"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",filters:[{text:"一键发布操作员",value:"一键发布操作员"},{text:"一键发布查询员",value:"一键发布查询员"},{text:"一键发布管理员",value:"一键发布管理员"}],"filter-method":e.filterHandler,"column-key":"roleName",sortable:"",label:"角色名称",prop:"roleName"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"角色Code",prop:"roleCode"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"创建时间",prop:"createTime"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"更新时间",prop:"updateTime"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{staticClass:"button-m-small",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.openDialog(a.row,"update")}}},[e._v("修改\n            ")]),e._v(" "),t("el-button",{staticClass:"button-m-small",attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.openDialog(a.row,"delete")}}},[e._v("删除\n            ")])]}}])})],1)],1),e._v(" "),t("el-dialog",{attrs:{visible:e.formDialog,title:e.dialogData.row.title,top:"5vh","close-on-click-modal":e.elDialogCloseOnClickModal,"destroy-on-close":e.elDialogDestroyOnClose},on:{"update:visible":function(a){e.formDialog=a},close:e.closeFormDialog}},[t("el-form",{ref:"addModule",staticStyle:{width:"100%","max-height":"70vh","overflow-y":"auto","overflow-x":"hidden",padding:"0 5px"},attrs:{model:e.formData,"label-position":"left","label-width":"100px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"角色名称：",prop:"roleName"}},[t("el-input",{model:{value:e.formData.roleName,callback:function(a){e.$set(e.formData,"roleName",a)},expression:"formData.roleName"}})],1)],1),e._v(" "),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"角色Code：",prop:"roleCode"}},[t("el-input",{model:{value:e.formData.roleCode,callback:function(a){e.$set(e.formData,"roleCode",a)},expression:"formData.roleCode"}})],1)],1)],1),e._v(" "),"add"!=e.dialogData.type?[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:18}},[t("el-form-item",{attrs:{label:"权限：",prop:"roleName"}},[[t("el-button",{directives:[{name:"show",rawName:"v-show",value:this.getBasePerNamesList2.length>0,expression:"this.getBasePerNamesList2.length>0"}],attrs:{type:"text"},on:{click:function(a){return e.setRoleNames("发布管理")}}},[e._v("\n                    发布管理")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:this.getBasePerNamesList3.length>0,expression:"this.getBasePerNamesList3.length>0"}],attrs:{type:"text"},on:{click:function(a){return e.setRoleNames1("镜像管理")}}},[e._v("镜像管理")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:this.getBasePerNamesList1.length>0,expression:"this.getBasePerNamesList1.length>0"}],attrs:{type:"text"},on:{click:function(a){return e.setRoleNames2("模块管理")}}},[e._v("模块管理")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:this.getBasePerNamesList4.length>0,expression:"this.getBasePerNamesList4.length>0"}],attrs:{type:"text"},on:{click:function(a){return e.setRoleNames4("基础配置")}}},[e._v("基础配置")]),e._v(" "),t("el-button",{directives:[{name:"show",rawName:"v-show",value:this.getBasePerNamesList.length>0,expression:"this.getBasePerNamesList.length>0"}],attrs:{type:"text"},on:{click:function(a){return e.setRoleNames3("基础配置")}}},[e._v("\n                    权限管理")])]],2)],1),e._v(" "),t("el-button",{attrs:{plain:""},on:{click:function(a){return e.openDialog("","base")}}},[e._v("点击选择")])],1)]:e._e()],2),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){return e.closeFormDialog("role")}}},[e._v("关闭")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(a){e.dialogVisible=a}}},[t("el-form",[t("el-form-item",{attrs:{prop:"formData.envNames"}},e._l(this.getBasePerNamesList2,function(a){return t("span",{key:a.prop},[t("el-tag",[e._v(e._s(a))])],1)}),0)],1),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.dialogVisible=!1}}},[e._v("确 定")])],1),e._v(" "),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible1,width:"30%"},on:{"update:visible":function(a){e.dialogVisible1=a}}},[t("el-form",[t("el-form-item",{attrs:{prop:"formData.envNames"}},e._l(this.getBasePerNamesList3,function(a){return t("span",{key:a.prop},[t("el-tag",[e._v(e._s(a))])],1)}),0)],1),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.dialogVisible1=!1}}},[e._v("确 定")])],1),e._v(" "),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible2,width:"30%"},on:{"update:visible":function(a){e.dialogVisible2=a}}},[t("el-form",[t("el-form-item",{attrs:{prop:"formData.envNames"}},e._l(this.getBasePerNamesList1,function(a){return t("span",{key:a.prop},[t("el-tag",[e._v(e._s(a))])],1)}),0)],1),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.dialogVisible2=!1}}},[e._v("确 定")])],1),e._v(" "),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible3,width:"30%"},on:{"update:visible":function(a){e.dialogVisible3=a}}},[t("el-form",[t("el-form-item",{attrs:{prop:"formData.envNames"}},e._l(this.getBasePerNamesList,function(a){return t("span",{key:a.prop},[t("el-tag",[e._v(e._s(a))])],1)}),0)],1),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.dialogVisible3=!1}}},[e._v("确 定")])],1),e._v(" "),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible4,width:"30%"},on:{"update:visible":function(a){e.dialogVisible4=a}}},[t("el-form",[t("el-form-item",{attrs:{prop:"formData.envNames"}},e._l(this.getBasePerNamesList4,function(a){return t("span",{key:a.prop},[t("el-tag",[e._v(e._s(a))])],1)}),0)],1),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.dialogVisible4=!1}}},[e._v("确 定")])],1),e._v(" "),"base"===e.name?[t("el-dialog",{attrs:{visible:e.formDialog},on:{"update:visible":function(a){e.formDialog=a}}},[t("el-row",{staticClass:"filter-container",attrs:{type:"flex"}},[t("el-input",{staticClass:"input-class",attrs:{clearable:"",placeholder:"输入信息"},model:{value:e.queryParams.keyName,callback:function(a){e.$set(e.queryParams,"keyName",a)},expression:"queryParams.keyName"}}),e._v(" "),t("el-button",{staticClass:"span-other",attrs:{icon:"el-icon-search",type:"primary"},on:{click:e.getList}},[e._v("查询")])],1),e._v(" "),t("el-card",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableDataBase,"element-loading-text":"拼命加载中...","row-key":e.getRowKey,"highlight-current-row":!0},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{fixed:"",type:"selection","reserve-selection":!0,width:"55"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"基础权限名称",prop:"basePerName"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"创建时间",prop:"createTime"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"修改时间",prop:"updateTime"}})],1)],1),e._v(" "),t("el-footer",{directives:[{name:"show",rawName:"v-show",value:0!=e.tableDataBase.length,expression:"tableDataBase.length != 0"}]},[t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.queryParams.pageNum,"page-count":e.pages,"page-size":e.queryParams.pageSize,"page-sizes":[5,10,15,30,50],total:e.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)]),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){return e.closeFormDialog("base")}}},[e._v("关闭")]),e._v(" "),"detail"!=e.name?[t("el-button",{attrs:{type:"primary"},on:{click:e.selectSubmit}},[e._v("确定")])]:e._e()],2)],1)]:e._e()],2)],1)},staticRenderFns:[]};var u=t("VU/8")(n,m,!1,function(e){t("l4A8")},"data-v-4bfc63ea",null);a.default=u.exports},l4A8:function(e,a){},lKKt:function(e,a,t){"use strict";a.d=function(e){return Object(s.a)({url:"/base/permission/all",method:"get",params:e})},a.g=function(e){return Object(s.a)({url:"/base/permission/updateOne",method:"post",data:e})},a.b=function(e){return Object(s.a)({url:"/base/permission/bindListBasePerm",method:"post",data:e})},a.a=function(e){return Object(s.a)({url:"/base/permission/addOne",method:"post",data:e})},a.e=function(e){return Object(s.a)({url:"/base/permission/getOne?basePermissionId="+e,method:"get"})},a.f=function(e){return Object(s.a)({url:"/base/permission/getBaseBindPermList?basePermissionId="+e,method:"get"})},a.c=function(e){return Object(s.a)({url:"/base/permission/delBasePerm",method:"post",params:e})};var s=t("Vo7i")},mvHQ:function(e,a,t){e.exports={default:t("qkKv"),__esModule:!0}},qkKv:function(e,a,t){var s=t("FeBl"),i=s.JSON||(s.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},z4ls:function(e,a,t){"use strict";a.d=function(){return Object(s.a)({url:"/role/getAllRole",method:"get"})},a.a=function(e){return Object(s.a)({url:"/role/insert",method:"post",data:e})},a.c=function(e){return Object(s.a)({url:"/role/getRoleBasePerm?roleId="+e,method:"get"})},a.e=function(e){return Object(s.a)({url:"/role/updateRolePermission",method:"post",data:e})},a.f=function(e){return Object(s.a)({url:"/role/updateRole",method:"post",data:e})},a.b=function(e){return Object(s.a)({url:"/role/deleteRole",method:"post",params:e})};var s=t("Vo7i")}});