webpackJsonp([29],{Ai93:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Vo7i"),r=a("mw3O"),i=a.n(r);var s=a("tzUi"),o={name:"ImageList",data:function(){return{options:[],clear:!1,gridData:[],dialogFormVisible:!1,fileList:[],listLoading:!1,fileTree:[],defaultProps:{children:"manageList",label:"moduleName",disabled:"disabled"},tableData:[],envSelect:[],queryParams:{envId:"",moduleId:"",nameCode:"",beginTime:"",endTime:"",pageNum:1,pageSize:5},form:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},formLabelWidth:"120px",rangeTime:"",pages:1,total:1,envPermission:{},dialogForm:!1,formData:{mirrorName:""}}},methods:{envIDChange:function(e){},sure:function(){var e,t=this;(e={envIds:this.queryParams.envId},Object(n.a)({url:"/mirror/harbor/clear",method:"post",data:e,transformRequest:[function(e){return e=i.a.stringify(e)}]})).then(function(e){var a=t;console.log(e),200==e.data.code?a.$message({message:"清理完成",type:"success"}):a.$message(e.data.data)}),this.dialogFormVisible=!1},searchEnvSelectChange:function(e){},getSelectList:function(){var e=this;Object(s.b)().then(function(t){e.options=t.data.data})},getimageList:function(){var e,t=this;Object(n.a)({url:"/center/show/modules",method:"get",params:e}).then(function(e){200==e.data.code?e.data.data.forEach(function(e){e.disabled=!0,e.moduleName=e.envName,e.icon_class="center";var a=[];e.centerList.forEach(function(e){e.moduleName=e.centerName,e.disabled=!0,e.icon_class="image_tree_center";var t=[];e.centerDTOList.forEach(function(e){e.moduleName=e.childCenterName,e.disabled=!0,e.icon_class="image_tree_center_children",t.push(e),e.manageList.forEach(function(e){e.icon_class="image_tree_module"})}),e.manageList=t,a.push(e)}),e.manageList=a,t.fileTree.push(e)}):t.fileTree=[]})},NodeClickHandler:function(e){e.id&&(this.queryParams={envId:"",moduleId:"",nameCode:"",beginTime:"",endTime:"",pageNum:1,pageSize:5},this.queryParams.moduleId=e.id,this.queryParams.envId=e.envId,this.envPermission=this.$store.state.user.permissionList.filter(function(t){return t.envId==e.envId})[0],this.rangeTime="",this.getList())},handleSizeChange:function(e){this.queryParams.pageSize=e,this.getList()},handleCurrentChange:function(e){this.queryParams.pageNum=e,this.getList()},queryTimeRangeHandler:function(){this.rangeTime?(this.queryParams.beginTime=this.rangeTime[0],this.queryParams.endTime=this.rangeTime[1]):(this.queryParams.beginTime="",this.queryParams.endTime="")},getList:function(){var e,t=this,a=this;a.listLoading=!0,a.queryTimeRangeHandler(),(e=a.queryParams,Object(n.a)({url:"/mirror/module/pageInfo",method:"get",params:e})).then(function(e){var n=e.data.data,r=e.data.code;200===r?(a.tableData=n.list,a.total=n.total,a.pages=n.pages,a.queryParams.pageNum=n.pageNum,a.queryParams.pageSize=n.pageSize):"未查询到任何数据"!=e.data.msg&&201!=r||(a.tableData=[]);setTimeout(function(){t.listLoading=!1},200)})},deleteOne:function(e){var t=this,a=this;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r;(r={mirrorId:e.id},Object(n.a)({url:"/mirror/deleteOne",method:"post",params:r,transformRequest:[function(e){return e=i.a.stringify(e)}]})).then(function(e){var n=e.data.code;t.$message({message:200==n?"删除成功":e.data.msg,type:200==n?"success":"error"}),200==n&&a.getList()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},openDialog:function(){this.dialogForm=!0},addImage:function(){var e,t=this;(e={moduleId:this.queryParams.moduleId,envId:this.queryParams.envId,mirrorName:this.formData.mirrorName},Object(n.a)({url:"/mirror/selfAppoint",method:"post",params:e,transformRequest:[function(e){return e=i.a.stringify(e)}]})).then(function(e){200==e.data.code?(t.getList(),t.closeForm()):t.$message({message:e.data.msg,type:"error"})})},closeForm:function(){this.dialogForm=!1,this.formData.mirrorName=""},permissionCheck:function(e){var t=[];return void 0!=this.envPermission&&this.envPermission.permissionSet&&(t=this.envPermission.permissionSet),t.includes(e)}},created:function(){this.getimageList(),this.getSelectList()}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"20px"}},[a("el-card",[a("el-container",[a("el-aside",{staticStyle:{border:"1px solid #dcdfe6",padding:"5px",width:"200px","max-height":"800px"}},[a("el-tree",{ref:"lishTree",staticClass:"filter-tree",attrs:{data:e.fileTree,"default-expand-all":!1,props:e.defaultProps,"icon-class":""},on:{"node-click":e.NodeClickHandler},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,r=t.data;return a("span",{staticClass:"custom-tree-node"},[a("svg-icon",{attrs:{"icon-class":r.icon_class}}),e._v(" "),a("span",[e._v(e._s(n.label))])],1)}}])})],1),e._v(" "),a("el-container",[a("el-main",{staticStyle:{padding:"0 20px"}},[e.permissionCheck("image_list_addImage")?a("el-button",{staticStyle:{float:"left"},attrs:{icon:"el-icon-edit",type:"primary"},on:{click:e.openDialog}},[e._v("添加镜像\n            ")]):e._e(),e._v(" "),a("el-row",{staticClass:"filter-container",attrs:{type:"flex"}},[a("span",{staticClass:"row-span-class span-other"},[e._v("生成时间")]),e._v(" "),a("el-date-picker",{attrs:{"end-placeholder":"结束日期","start-placeholder":"开始日期",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.rangeTime,callback:function(t){e.rangeTime=t},expression:"rangeTime"}}),e._v(" "),a("el-input",{staticClass:"input-class span-other",attrs:{clearable:"",placeholder:"模糊查询"},model:{value:e.queryParams.nameCode,callback:function(t){e.$set(e.queryParams,"nameCode",t)},expression:"queryParams.nameCode"}}),e._v(" "),a("el-button",{staticClass:"span-other",attrs:{icon:"el-icon-search",type:"primary"},on:{click:e.getList}},[e._v("查询")]),e._v(" "),a("el-button",{staticClass:"span-other",attrs:{type:"danger"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("清理仓库 ")])],1),e._v(" "),a("el-dialog",{attrs:{title:"清理仓库",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.form}},[a("el-form-item",{attrs:{label:"选择环境","label-width":e.formLabelWidth}},[a("el-select",{attrs:{change:"envIDChange",placeholder:"请选择"},model:{value:e.queryParams.envId,callback:function(t){e.$set(e.queryParams,"envId",t)},expression:"queryParams.envId"}},e._l(e.options,function(e){return a("el-option",{key:e.id,attrs:{label:e.envName,value:e.id}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.sure}},[e._v("确 定")])],1)],1),e._v(" "),a("el-card",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"element-loading-text":"拼命加载中...","highlight-current-row":!0}},[a("el-table-column",{attrs:{align:"center",label:"序号",type:"index",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.$index+1+e.queryParams.pageSize*(e.queryParams.pageNum-1))+"\n                  ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"环境名称",prop:"envName"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"是否可用",prop:"isAvailable"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(0==t.row.isAvailable?"否":"是")+"\n                  ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"任务名称",prop:"jobName"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"任务版本",prop:"jobReversion"}}),e._v(" "),a("el-table-column",{attrs:{align:"left","header-align":"center",label:"镜像名称",prop:"mirrorName",width:"300"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"模块名称",prop:"moduleName"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"生成时间",prop:"updateTime",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.permissionCheck("image_list_delete")?a("el-button",{staticClass:"button-m-small",attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.deleteOne(t.row)}}},[e._v("删除\n                    ")]):e._e()]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogForm,title:"添加镜像",top:"5vh","close-on-click-modal":e.elDialogCloseOnClickModal,"destroy-on-close":e.elDialogDestroyOnClose},on:{"update:visible":function(t){e.dialogForm=t},close:e.closeForm}},[a("el-form",{ref:"formTask",staticStyle:{width:"100%","max-height":"85vh"},attrs:{model:e.formData,"label-position":"left","label-width":"95px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"镜像名称",prop:"mirrorName"}},[a("el-input",{model:{value:e.formData.mirrorName,callback:function(t){e.$set(e.formData,"mirrorName",t)},expression:"formData.mirrorName"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeForm}},[e._v("关闭")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addImage()}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-footer",{directives:[{name:"show",rawName:"v-show",value:0!=e.tableData.length,expression:"tableData.length != 0"}]},[a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":e.queryParams.pageNum,"page-count":e.pages,"page-size":e.queryParams.pageSize,"page-sizes":[5,10,15,30,50],total:e.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)])],1)],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(o,l,!1,function(e){a("CjMf")},"data-v-fd741d8e",null);t.default=c.exports},CjMf:function(e,t){},tzUi:function(e,t,a){"use strict";t.a=function(e){return Object(n.a)({url:"/moduleEnv/delectOne",method:"post",data:e,transformRequest:[function(e){return e=i.a.stringify(e)}]})},t.e=function(e){return Object(n.a)({url:"/moduleEnv/selectPsAll",method:"get",params:e})},t.d=function(e){return Object(n.a)({url:"/moduleEnv/insertOneEnv",method:"post",data:e,transformRequest:[function(e){return e=i.a.stringify(e)}]})},t.f=function(e){return Object(n.a)({url:"/moduleEnv/update",method:"post",data:e,transformRequest:[function(e){return e=i.a.stringify(e)}]})},t.c=function(e){return Object(n.a)({url:"/moduleEnv/selectOne",method:"get",params:e})},t.b=function(e){return Object(n.a)({url:"/moduleEnv/getAllModuleEnv",method:"get",params:e})};var n=a("Vo7i"),r=a("mw3O"),i=a.n(r)}});