webpackJsonp([31],{"6Dqm":function(t,e){},f61E:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("Xxa5"),i=a.n(l),n=a("exGp"),o=a.n(n),s=a("T60X"),r={name:"Details",data:function(){return{listLoading:!1,dialogVisible:!1,showType:"jilu",params:{moduleId:"",envId:""},tableData:[],logDetails:"",logObject:{},envPermission:{},jiluData:[]}},methods:{changeTab:function(){this.tableData=[],"log"===this.showType?this.getJobDetails(this.params.jobId):"record"==this.showType?this.getMirrorByJobId(this.params.jobId):"jilu"==this.showType&&this.getBuildInfo(this.params)},goBack:function(){this.$router.push({path:"/image/index",query:{data:this.params.envId}})},getJobConsoleOutput:function(t){this.dialogVisible=!0,this.dialogVisibleData=t,this.logDetails="";var e=this;Object(s.c)({jobId:e.logObject.jobId,buildNumber:t.buildNumber}).then(function(t){var a=t.data.code;if(200===a)e.logDetails=t.data.data,e.$nextTick(function(){var t=e.$refs["log-container"];t.scrollTop=t.scrollHeight});else{var l=t.data.msg;e.$message({message:l,type:"warning"}),"未查询到任何数据"!=l&&201!=a||(e.logDetails="")}})},getJobDetails:function(t){var e=this,a=this;this.listLoading=!0,Object(s.d)({jobId:t}).then(function(t){var l=t.data.code;200==l?(a.tableData=t.data.data.buildDetails,a.logObject=t.data.data):"未查询到任何数据"!=t.data.msg&&201!=l||(a.tableData=[]);setTimeout(function(){e.listLoading=!1},200)})},getMirrorByJobId:function(t){var e=this,a=this;this.listLoading=!0,Object(s.e)({jobId:t}).then(function(t){var l=t.data.code;200==l?a.tableData=t.data.data:"未查询到任何数据"!=t.data.msg&&201!=l||(a.tableData=[]);setTimeout(function(){e.listLoading=!1},200)})},permissionCheck:function(t){var e=[];return void 0!=this.envPermission&&this.envPermission.permissionSet&&(e=this.envPermission.permissionSet),e.includes(t)},getBuildInfo:function(){var t=this;return o()(i.a.mark(function e(){var a,l,n,o,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params,l=a.envId,n=a.moduleId,o={envId:l,moduleId:n},e.next=4,Object(s.i)(o);case 4:200==(r=e.sent).status?t.$set(t,"jiluData",r.data):t.$message.error("获取失败");case 6:case"end":return e.stop()}},e,t)}))()}},mounted:function(){var t=this.$store.state.app.lastRouteData;this.params=t,this.params.envId=t.envId,this.params.moduleId=t.moduleId,this.getBuildInfo()}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-main",[a("el-row",{staticClass:"filter-container",attrs:{type:"flex"}},[a("el-button",{attrs:{icon:"el-icon-back",size:"mini",type:"primary"},on:{click:t.goBack}},[t._v("返回")])],1),t._v(" "),a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.changeTab},model:{value:t.showType,callback:function(e){t.showType=e},expression:"showType"}},[a("div",{staticStyle:{"border-bottom":"1px solid #dcdfe6",padding:"0 0 10px 0"}},[a("span",{staticClass:"span-class"},[t._v("模块："+t._s(t.params.moduleName))])]),t._v(" "),a("el-tab-pane",{attrs:{label:"构建记录",name:"jilu"}},[a("el-table",{attrs:{data:t.jiluData}},[a("el-table-column",{attrs:{label:"创建时间",prop:"createTime"}}),t._v(" "),a("el-table-column",{attrs:{label:"创建人",prop:"creator"}}),t._v(" "),a("el-table-column",{attrs:{label:"当前构建状态",prop:"currentBuildStatus"}})],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"构建日志",name:"log"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"appTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"highlight-current-row":!0,"element-loading-text":"拼命加载中..."}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.$index+1)+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"版本号",prop:"buildNumber"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"是否正在构建中",prop:"IsBuilding"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.IsBuilding?"是":"否")+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"构建结果",prop:"result"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"构建耗时(ms)",prop:"duration"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"构建启动时间",prop:"buildDate"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.permissionCheck("image_make_run_job_log")?a("el-button",{staticClass:"button-m-small",attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.getJobConsoleOutput(e.row)}}},[t._v("\n                查看详情\n              ")]):t._e()]}}])})],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"镜像生成记录",name:"record"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"appTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"highlight-current-row":!0,"element-loading-text":"拼命加载中..."}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.$index+1)+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"left","header-align":"center",label:"镜像名称",prop:"mirrorName"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"任务版本",prop:"jobReversion"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"是否可用",prop:"isAvailable"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(1==e.row.isAvailable?"是":"否")+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"生成时间",prop:"updateTime",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"创建时间",prop:"createTime",width:"180"}})],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,title:"日志详情",top:"5vh",width:"66%","close-on-click-modal":t.elDialogCloseOnClickModal,"destroy-on-close":t.elDialogDestroyOnClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.permissionCheck("image_make_run_job_log")?a("el-button",{staticClass:"button-m-small",staticStyle:{margin:"0 0 5px 0"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.getJobConsoleOutput(t.dialogVisibleData)}}},[t._v("\n        刷新\n      ")]):t._e(),t._v(" "),a("div",{ref:"log-container",staticClass:"log-container",staticStyle:{"max-height":"70vh"}},[a("pre",{staticStyle:{"word-wrap":"break-word","white-space":"pre-wrap"},domProps:{textContent:t._s(t.logDetails)}},[t._v("                ")])]),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("关闭")])],1)],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(r,c,!1,function(t){a("6Dqm")},"data-v-38d65aee",null);e.default=d.exports}});